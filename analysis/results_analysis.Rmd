---
title: "Navigo - Agents"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Load files

```{r cars}
nasa_tlx <- read.csv("../results/nasa_tlx.csv", stringsAsFactors = FALSE)
decision_points <- read.csv("../results/decision_points.csv", stringsAsFactors = FALSE)
post_trial <- read.csv("../results/post_trial.csv", stringsAsFactors = FALSE)
```

## RQ1.a: Workload - NASA TLX

### Pure Conditions

```{r pressure, echo=FALSE}
text_color = paletteer_d(ghibli, MarnieLight1)[2]

nasa_tlx %>% 
  select(subject, pd.total, po.total, pe.total) %>% 
  melt(id("subject")) %>% 
  ggplot(aes(x = variable, y = value)) +
  geom_jitter(alpha = .7, width = .25, height = .25) + 
  aes(col = variable) +
  scale_color_discrete(guide = FALSE) + 
  geom_boxplot(aes(fill = variable), colour = text_color, show.legend = FALSE, 
               outlier.shape = NA, alpha = 0.4) +
  labs(title = "NASA TLX Scores for pure conditions",
       x = "",
       y = "NASA TLX Score") +
  theme_tufte(base_family = "Avenir", ticks = FALSE)
```

*PD Condition*

```{r}
hist(nasa_tlx$pd.total, col="red", xlim=c(1,100), prob=TRUE)
x <- seq(1,100,0.1)
curve(dnorm(x,mean=mean(nasa_tlx$pd.total), sd=sd(nasa_tlx$pd.total)), 1, 100, col="blue", add=TRUE)
stat.desc(nasa_tlx$pd.total)
```

PD scores are normally distributed. p-value is greater than 0.05 thus the null hypothesis that it is normally distributed is NOT rejected.

```{r}
shapiro.test(nasa_tlx$pd.total)
```

*PO Condition*

```{r}
hist(nasa_tlx$po.total, col="red", xlim=c(1,100), prob=TRUE)
x <- seq(1,100,0.1)
curve(dnorm(x,mean=mean(nasa_tlx$po.total), sd=sd(nasa_tlx$po.total)), 1, 100, col="blue", add=TRUE)
stat.desc(nasa_tlx$po.total)
```

PO scores are normally distributed. p-value is greater than 0.05 thus the null hypothesis that it is normally distributed is NOT rejected.

```{r}
shapiro.test(nasa_tlx$po.total)
```

*PE Condition*

```{r}
hist(nasa_tlx$pe.total, col="red", xlim=c(1,100), prob=TRUE)
x <- seq(1,100,0.1)
curve(dnorm(x,mean=mean(nasa_tlx$pe.total), sd=sd(nasa_tlx$pe.total)), 1, 100, col="blue", add=TRUE)
stat.desc(nasa_tlx$pe.total)
```

PE scores are normally distributed. p-value is greater than 0.05 thus the null hypothesis that it is normally distributed is NOT rejected.

```{r}
shapiro.test(nasa_tlx$pe.total)
```

#### Paired t-test

*Fisher's F Test*

_PD vs PO_
Variances are equal because p-value > 0.05 which does NOT reject the null hypothesis.

```{r}
var.test(nasa_tlx$pd.total, nasa_tlx$po.total)
var.test(nasa_tlx$po.total, nasa_tlx$pd.total)
```

_PD vs PE_
Variances are equal because p-value > 0.05 which does NOT reject the null hypothesis.

```{r}
var.test(nasa_tlx$pd.total, nasa_tlx$pe.total)
var.test(nasa_tlx$pe.total, nasa_tlx$pd.total)
```

_PO vs PE_
Variances are equal because p-value > 0.05 which does NOT reject the null hypothesis.

```{r}
var.test(nasa_tlx$po.total, nasa_tlx$pe.total)
var.test(nasa_tlx$pe.total, nasa_tlx$po.total)
```

*Student's Paired t-test*
* Workload for Pure Driver condition is significantly less than the workload for Pure Optimal condition
* Workload for Pure Driver condition is significantly less than the workload for Pure Explorer condition
* Workload for Pure Optimal condition is significantly greater than the workload for Pure Explorer condition

```{r}
t.test(nasa_tlx$pd.total, nasa_tlx$po.total, paired = TRUE, alternative = "less")
t.test(nasa_tlx$pd.total, nasa_tlx$pe.total, paired = TRUE, alternative = "less")
t.test(nasa_tlx$po.total, nasa_tlx$pe.total, paired = TRUE, alternative = "greater")
```

### Shapiro-Wilk's Normality Tests for other Conditions

*DO Condition*

```{r}
hist(nasa_tlx$do.total, col="red", xlim=c(1,100), prob=TRUE)
x <- seq(1,100,0.1)
curve(dnorm(x,mean=mean(nasa_tlx$do.total), sd=sd(nasa_tlx$do.total)), 1, 100, col="blue", add=TRUE)
stat.desc(nasa_tlx$do.total)
shapiro.test(nasa_tlx$do.total)
```

*DE Condition*

```{r}
hist(nasa_tlx$de.total, col="red", xlim=c(1,100), prob=TRUE)
x <- seq(1,100,0.1)
curve(dnorm(x,mean=mean(nasa_tlx$de.total), sd=sd(nasa_tlx$de.total)), 1, 100, col="blue", add=TRUE)
stat.desc(nasa_tlx$de.total)
shapiro.test(nasa_tlx$de.total)
```

*OD Condition*

```{r}
hist(nasa_tlx$od.total, col="red", xlim=c(1,100), prob=TRUE)
x <- seq(1,100,0.1)
curve(dnorm(x,mean=mean(nasa_tlx$od.total), sd=sd(nasa_tlx$od.total)), 1, 100, col="blue", add=TRUE)
stat.desc(nasa_tlx$od.total)
shapiro.test(nasa_tlx$od.total)
```

*OE Condition*

```{r}
hist(nasa_tlx$oe.total, col="red", xlim=c(1,100), prob=TRUE)
x <- seq(1,100,0.1)
curve(dnorm(x,mean=mean(nasa_tlx$oe.total), sd=sd(nasa_tlx$oe.total)), 1, 100, col="blue", add=TRUE)
stat.desc(nasa_tlx$oe.total)
shapiro.test(nasa_tlx$oe.total)
```

*ED Condition*

```{r}
hist(nasa_tlx$ed.total, col="red", xlim=c(1,100), prob=TRUE)
x <- seq(1,100,0.1)
curve(dnorm(x,mean=mean(nasa_tlx$ed.total), sd=sd(nasa_tlx$ed.total)), 1, 100, col="blue", add=TRUE)
stat.desc(nasa_tlx$ed.total)
shapiro.test(nasa_tlx$ed.total)
```

*EO Condition*

```{r}
hist(nasa_tlx$eo.total, col="red", xlim=c(1,100), prob=TRUE)
x <- seq(1,100,0.1)
curve(dnorm(x,mean=mean(nasa_tlx$eo.total), sd=sd(nasa_tlx$eo.total)), 1, 100, col="blue", add=TRUE)
stat.desc(nasa_tlx$eo.total)
shapiro.test(nasa_tlx$eo.total)
```

### Driver Model factorial conditions

```{r}
nasa_tlx %>% 
  select(subject, pd.total, do.total, de.total, od.total, ed.total) %>% 
  melt(id("subject")) %>% 
  ggplot(aes(x = variable, y = value)) +
  geom_jitter(alpha = .7, width = .25, height = .25) + 
  aes(col = variable) +
  scale_color_brewer(palette = "Set2", guide = FALSE) + 
  geom_boxplot(aes(fill = variable), colour = text_color, show.legend = FALSE, 
               outlier.shape = NA, alpha = 0.4) +
  scale_fill_brewer(palette = "Set2", guide = FALSE) +
  labs(title = "NASA TLX Scores for Driver conditions",
       x = "",
       y = "NASA TLX Score") +
  theme_tufte(base_family = "Avenir", ticks = FALSE)
```

#### Paired t-test

*Fisher's F Test*

```{r}
var.test(nasa_tlx$pd.total, nasa_tlx$do.total)
var.test(nasa_tlx$pd.total, nasa_tlx$de.total)
var.test(nasa_tlx$pd.total, nasa_tlx$od.total)
var.test(nasa_tlx$pd.total, nasa_tlx$ed.total)
```

*Student's Paired t-test*

```{r}
t.test(nasa_tlx$do.total, nasa_tlx$pd.total, paired = TRUE, alternative = "greater")
t.test(nasa_tlx$de.total, nasa_tlx$pd.total, paired = TRUE, alternative = "greater")
t.test(nasa_tlx$od.total, nasa_tlx$pd.total, paired = TRUE, alternative = "greater")
t.test(nasa_tlx$ed.total, nasa_tlx$pd.total, paired = TRUE, alternative = "greater")
```

### Explorer Conditions

```{r}
nasa_tlx %>% 
  select(subject, pe.total, ed.total, eo.total, de.total, oe.total) %>% 
  melt(id("subject")) %>% 
  ggplot(aes(x = variable, y = value)) +
  geom_jitter(alpha = .7, width = .25, height = .25) + 
  aes(col = variable) +
  scale_color_discrete(guide = FALSE) + 
  geom_boxplot(aes(fill = variable), colour = text_color, show.legend = FALSE, 
               outlier.shape = NA, alpha = 0.4) +
  labs(title = "NASA TLX Scores for Explorer conditions",
       x = "",
       y = "NASA TLX Score") +
  theme_tufte(base_family = "Avenir", ticks = FALSE)
```

#### Paired t-test

*Fisher's F Test*

```{r}
var.test(nasa_tlx$pe.total, nasa_tlx$ed.total)
var.test(nasa_tlx$pe.total, nasa_tlx$eo.total)
var.test(nasa_tlx$pe.total, nasa_tlx$de.total)
var.test(nasa_tlx$pe.total, nasa_tlx$oe.total)
```

*Student's Paired t-test*

```{r}
t.test(nasa_tlx$ed.total, nasa_tlx$pe.total, paired = TRUE, alternative = "greater")
t.test(nasa_tlx$de.total, nasa_tlx$pe.total, paired = TRUE, alternative = "greater")
t.test(nasa_tlx$oe.total, nasa_tlx$pe.total, paired = TRUE, alternative = "greater")
```

*Wilcoxon Signed-rank test*
* EO Condition has a significantly greater workload compared to the Pure E condition.

```{r}
wilcox.test(nasa_tlx$eo.total, nasa_tlx$pe.total, paired = TRUE, alternative = "greater")
```

### Optimal Conditions

```{r}
nasa_tlx %>% 
  select(subject, po.total, od.total, oe.total, do.total, eo.total) %>% 
  melt(id("subject")) %>% 
  ggplot(aes(x = variable, y = value)) +
  geom_jitter(alpha = .7, width = .25, height = .25) + 
  aes(col = variable) +
  scale_color_discrete(guide = FALSE) + 
  geom_boxplot(aes(fill = variable), colour = text_color, show.legend = FALSE, 
               outlier.shape = NA, alpha = 0.4) +
  labs(title = "NASA TLX Scores for Optimal conditions",
       x = "",
       y = "NASA TLX Score") +
  theme_tufte(base_family = "Avenir", ticks = FALSE)
```

#### Paired t-test

*Fisher's F Test*

```{r}
var.test(nasa_tlx$po.total, nasa_tlx$od.total)
var.test(nasa_tlx$po.total, nasa_tlx$oe.total)
var.test(nasa_tlx$po.total, nasa_tlx$do.total)
var.test(nasa_tlx$po.total, nasa_tlx$eo.total)
```

*Student's Paired t-test*
* The DO condition had a significantly greater workload than the Pure O condition.

```{r}
t.test(nasa_tlx$od.total, nasa_tlx$po.total, paired = TRUE, alternative = "greater")
t.test(nasa_tlx$oe.total, nasa_tlx$po.total, paired = TRUE, alternative = "greater")
t.test(nasa_tlx$do.total, nasa_tlx$po.total, paired = TRUE, alternative = "greater")
```

*Wilcoxon Signed-rank test*
* EO Condition has a significantly greater workload compared to the Pure E condition.

```{r}
wilcox.test(nasa_tlx$eo.total, nasa_tlx$po.total, paired = TRUE, alternative = "greater")
```

## RQ1.b: Deviations

### Impact on Deviations

```{r}
decision_points %>% 
  select(subject, task, devratio) %>% 
  # filter(devratio > 0.0) %>% 
  mutate(task = factor(task, levels = c("PD", "DO", "DE", "PO", "OD", "OE", "PE", "ED", "EO"))) %>% 
  ggplot(aes(x = task, y = devratio)) +
  geom_jitter(alpha = .7, width = .25, height = 0) + 
  aes(col = task) +
  scale_color_discrete(guide = FALSE) + 
  geom_boxplot(aes(fill = task), colour = text_color, show.legend = FALSE, 
               outlier.shape = NA, alpha = 0.4) +
  labs(title = "Deviation Ratio per Condition",
       subtitle = "Only included drives with >0 deviations",
       x = "",
       y = "Deviation Ratio") +
  theme_tufte(base_family = "Avenir", ticks = FALSE)
```

```{r}
decision_points %>% 
  select(subject, choice, devratio) %>% 
  # filter(devratio > 0.0) %>% 
  mutate(choice = factor(choice, levels = c("D", "O", "E", "N"))) %>% 
  ggplot(aes(x = choice, y = devratio)) +
  geom_jitter(alpha = .7, width = .25, height = 0) + 
  aes(col = choice) +
  scale_color_discrete(guide = FALSE) + 
  geom_boxplot(aes(fill = choice), colour = text_color, show.legend = FALSE, 
               outlier.shape = NA, alpha = 0.4) +
  labs(title = "Deviation Ratio per Choice",
       subtitle = "Only included drives with >0 deviations",
       x = "",
       y = "Deviation Ratio") +
  theme_tufte(base_family = "Avenir", ticks = FALSE)
```

### Histogram of Choices

```{r}
decision_points %>% 
  select(subject, task, choice) %>% 
  mutate(task = factor(task, levels = c("PD", "DO", "DE", "PO", "OD", "OE", "PE", "ED", "EO"))) %>% 
  mutate(choice = factor(choice, levels = c("N", "E", "O", "D"))) %>% 
  group_by(task) %>% 
  ggplot(aes(x = choice)) +
  geom_bar(alpha = 0.8) +
  aes(fill = choice) +
  scale_fill_brewer(palette = "Set2", guide = FALSE) + 
  coord_flip() +
  facet_wrap(~task) +
  labs(title = "Choice per Condition",
       x = "",
       y = "") +
  theme_tufte(base_family = "Avenir", ticks = TRUE)
```

## RQ2: Confidence and Trust

### Confidence

```{r}
post_trial %>% 
  mutate(pd = pd.conf, po = po.conf, pe = pe.conf, do = do.conf, de = de.conf, od = od.conf, oe = oe.conf, ed = ed.conf, eo = eo.conf) %>% 
  select(subject, pd, do, de, po, od, oe, pe, ed, eo) %>% 
  melt(id("subject")) %>% 
  ggplot(aes(x = value)) +
  geom_bar() +
  aes(fill = variable) + 
  scale_fill_viridis_d(guide = FALSE) + 
  facet_wrap(~variable) +
  theme_tufte(base_family = "Avenir", ticks = FALSE)
```

*Shapiro-Wilk's Test*

```{r}
shapiro.test(post_trial$pd.conf)
shapiro.test(post_trial$po.conf)
shapiro.test(post_trial$pe.conf)
shapiro.test(post_trial$od.conf)
shapiro.test(post_trial$oe.conf)
shapiro.test(post_trial$do.conf)
shapiro.test(post_trial$de.conf)
shapiro.test(post_trial$ed.conf)
shapiro.test(post_trial$eo.conf)
```

*Wilcoxon Signed-rank test*

```{r}
wilcox.test(post_trial$od.conf, post_trial$pd.conf, paired = TRUE)
wilcox.test(post_trial$ed.conf, post_trial$pd.conf, paired = TRUE)
wilcox.test(post_trial$do.conf, post_trial$po.conf, paired = TRUE)
wilcox.test(post_trial$eo.conf, post_trial$po.conf, paired = TRUE)
wilcox.test(post_trial$de.conf, post_trial$pe.conf, paired = TRUE)
wilcox.test(post_trial$oe.conf, post_trial$pe.conf, paired = TRUE)
```

### Trust

```{r}
post_trial %>% 
  mutate(pd = pd.trust, po = po.trust, pe = pe.trust, do = do.trust, de = de.trust, 
         od = od.trust, oe = oe.trust, ed = ed.trust, eo = eo.trust) %>% 
  select(subject, pd, do, de, po, od, oe, pe, ed, eo) %>% 
  melt(id("subject")) %>% 
  ggplot(aes(x = value)) +
  geom_bar() +
  aes(fill = variable) + 
  scale_fill_viridis_d(guide = FALSE) + 
  facet_wrap(~variable) +
  theme_tufte(base_family = "Avenir", ticks = FALSE)
```

*Wilcoxon Signed-rank test*

```{r}
wilcox.test(post_trial$od.trust, post_trial$pd.trust, paired = TRUE)
wilcox.test(post_trial$ed.trust, post_trial$pd.trust, paired = TRUE)
wilcox.test(post_trial$do.trust, post_trial$po.trust, paired = TRUE)
wilcox.test(post_trial$eo.trust, post_trial$po.trust, paired = TRUE)
wilcox.test(post_trial$de.trust, post_trial$pe.trust, paired = TRUE)
wilcox.test(post_trial$oe.trust, post_trial$pe.trust, paired = TRUE)
```

## RQ3: Detect Conversations


```{r}
post_trial %>% 
  filter(subject > 3) %>% 
  mutate(pd = pd.conv, po = po.conv, pe = pe.conv, do = do.conv, de = de.conv, 
         od = od.conv, oe = oe.conv, ed = ed.conv, eo = eo.conv) %>% 
  select(subject, pd, do, de, po, od, oe, pe, ed, eo) %>% 
  melt(id("subject")) %>% 
  mutate(value = case_when(value == 1 ~ "Yes",
                           value == 0 ~ "No")) %>% 
  ggplot(aes(x = value)) +
  geom_bar() +
  aes(fill = value) + 
  scale_fill_viridis_d(guide = FALSE) + 
  facet_wrap(~variable) +
  coord_flip() +
  theme_tufte(base_family = "Avenir", ticks = FALSE)
```

## RQ4: Familiarization vs Choice

### All conditions

```{r}
familiarization <- post_trial %>% 
  select(subject, f.good)

decision_points %>% 
  left_join(familiarization) %>% 
  select(subject, choice, f.good) %>% 
  filter(subject > 3) %>% 
  count(subject, choice, f.good) %>% 
  mutate(ratio_choice = ceiling((n/9)*100)) %>% 
  group_by(choice, f.good) %>% 
  summarize(mean_ratio_choice = mean(ratio_choice, na.rm = TRUE)) %>% 
  ggplot(aes(x = f.good, y = mean_ratio_choice)) +
  geom_col() +
  aes(fill = choice) +
  scale_fill_viridis_d(guide = FALSE) +
  facet_wrap(~choice) +
  theme_tufte(base_family = "Avenir", ticks = FALSE)
```

### Only conditions with D

```{r}
decision_points %>% 
  left_join(familiarization) %>% 
  filter(subject > 3) %>% 
  filter(agent1 == 'D' | agent2 == 'D') %>% 
  select(subject, choice, f.good) %>% 
  count(subject, choice, f.good) %>% 
  mutate(ratio_choice = ceiling((n/5)*100)) %>% 
  group_by(f.good, choice) %>% 
  summarize(mean_ratio_choice = mean(ratio_choice, na.rm = TRUE)) %>% 
  ggplot(aes(x = choice, y = mean_ratio_choice)) +
  geom_col() +
  aes(fill = choice) +
  scale_fill_viridis_d(guide = FALSE) +
  facet_wrap(~f.good) +
  theme_tufte(base_family = "Avenir", ticks = FALSE)
```

### Conditions with D scenarios

```{r}
decision_points %>% 
  left_join(familiarization) %>% 
  filter(subject > 3) %>% 
  filter(task == 'PD' | agent2 == 'D') %>% 
  select(subject, choice, f.good) %>% 
  count(subject, choice, f.good) %>% 
  mutate(ratio_choice = ceiling((n/3)*100)) %>% 
  group_by(f.good, choice) %>% 
  summarize(mean_ratio_choice = mean(ratio_choice, na.rm = TRUE)) %>% 
  ggplot(aes(x = choice, y = mean_ratio_choice)) +
  geom_col() +
  aes(fill = choice) +
  scale_fill_viridis_d(guide = FALSE) +
  facet_wrap(~f.good) +
  theme_tufte(base_family = "Avenir", ticks = FALSE)
```


